{"version":3,"sources":["webpack:///./src/views/recommendMusic/RecommendMusic.vue?c931","webpack:///src/views/recommendMusic/RecommendMusic.vue","webpack:///./src/views/recommendMusic/RecommendMusic.vue?7418","webpack:///./src/views/recommendMusic/RecommendMusic.vue","webpack:///./src/views/recommendMusic/RecommendMusic.vue?1d73","webpack:///./src/assets/img/recommendMusic.png"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_m","on","playAll","_v","recommendMusic","length","staticStyle","attrs","clickRow","clickCell","handleIndex","_e","staticRenderFns","name","data","recommendMusicListId","methods","getRecommendMusic","changeOrigin","res","musicList","musicListId","index","row","handleDOM","current","last","querySelector","querySelectorAll","tableRows","innerHTML","classList","add","lastIndex","remove","column","cell","id","url","serve","params","downloadMusicInfo","created","mounted","watch","component","module","exports"],"mappings":"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","file":"js/chunk-127b9ec2.957a0a90.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"recommendMusic\"},[_c('div',{staticClass:\"recommendInfo\"},[_vm._m(0),_c('div',{staticClass:\"buttons\"},[_c('div',{staticClass:\"buttonItem playAll\",on:{\"click\":_vm.playAll}},[_c('i',{staticClass:\"iconfont icon-bofang playAll\"}),_c('span',[_vm._v(\"播放全部\")])]),_vm._m(1)])]),(_vm.recommendMusic.length != 0)?_c('div',[_c('el-table',{staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.recommendMusic,\"size\":\"mini\",\"highlight-current-row\":\"\",\"stripe\":\"\",\"lazy\":\"\"},on:{\"row-dblclick\":_vm.clickRow,\"cell-click\":_vm.clickCell}},[_c('el-table-column',{attrs:{\"label\":\"\",\"width\":\"30\",\"type\":\"index\",\"index\":_vm.handleIndex}}),_c('el-table-column',{attrs:{\"label\":\"\",\"width\":\"23\"}},[_c('i',{staticClass:\"iconfont icon-download\"})]),_c('el-table-column',{attrs:{\"prop\":\"name\",\"label\":\"音乐标题\",\"min-width\":\"350\"}}),_c('el-table-column',{attrs:{\"prop\":\"ar[0].name\",\"label\":\"歌手\",\"min-width\":\"120\"}}),_c('el-table-column',{attrs:{\"prop\":\"al.name\",\"label\":\"专辑\",\"min-width\":\"170\"}}),_c('el-table-column',{attrs:{\"prop\":\"dt\",\"label\":\"时长\",\"min-width\":\"100\"}})],1),_c('div',{staticClass:\"placeholder\"})],1):_vm._e()])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"title\"},[_c('div',{staticClass:\"cover\"},[_c('img',{attrs:{\"src\":require(\"assets/img/recommendMusic.png\"),\"alt\":\"\"}})]),_c('div',{staticClass:\"titleInfo\"},[_c('div',{staticClass:\"infoTop\"},[_vm._v(\"每日歌曲推荐\")]),_c('div',{staticClass:\"infoBottom\"},[_vm._v(\"根据你的音乐口味生成，每天6:00更新\")])])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"buttonItem\"},[_c('i',{staticClass:\"iconfont icon-xihuan\"}),_c('span',[_vm._v(\"收藏全部\")])])}]\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"recommendMusic\">\n    <!-- 每日推荐歌曲信息 -->\n    <div class=\"recommendInfo\">\n      <div class=\"title\">\n        <div class=\"cover\">\n          <img src=\"~assets/img/recommendMusic.png\" alt=\"\" />\n        </div>\n        <div class=\"titleInfo\">\n          <div class=\"infoTop\">每日歌曲推荐</div>\n          <div class=\"infoBottom\">根据你的音乐口味生成，每天6:00更新</div>\n        </div>\n      </div>\n      <!-- 操作按钮 -->\n      <div class=\"buttons\">\n        <div class=\"buttonItem playAll\" @click=\"playAll\">\n          <i class=\"iconfont icon-bofang playAll\"></i>\n          <span>播放全部</span>\n        </div>\n        <div class=\"buttonItem\">\n          <i class=\"iconfont icon-xihuan\"></i>\n          <span>收藏全部</span>\n        </div>\n      </div>\n    </div>\n    <!-- 歌曲列表 -->\n    <div v-if=\"recommendMusic.length != 0\">\n      <!-- 表格 -->\n      <el-table\n        :data=\"recommendMusic\"\n        size=\"mini\"\n        style=\"width: 100%\"\n        @row-dblclick=\"clickRow\"\n        @cell-click=\"clickCell\"\n        highlight-current-row\n        stripe\n        lazy\n      >\n        <el-table-column label=\"\" width=\"30\" type=\"index\" :index=\"handleIndex\">\n        </el-table-column>\n        <el-table-column label=\"\" width=\"23\">\n          <!-- 下载按钮 -->\n          <i class=\"iconfont icon-download\"></i>\n        </el-table-column>\n        <el-table-column prop=\"name\" label=\"音乐标题\" min-width=\"350\">\n        </el-table-column>\n        <el-table-column prop=\"ar[0].name\" label=\"歌手\" min-width=\"120\">\n        </el-table-column>\n        <el-table-column prop=\"al.name\" label=\"专辑\" min-width=\"170\">\n        </el-table-column>\n        <el-table-column prop=\"dt\" label=\"时长\" min-width=\"100\">\n        </el-table-column>\n      </el-table>\n      <div class=\"placeholder\"></div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { handleMusicTime } from 'plugins/util'\n\nexport default {\n  name: 'RecommendMusic',\n  data () {\n    return {\n      // 每日推荐歌曲列表\n      recommendMusic: [],\n      //   每日推荐id （自己起的，用于上传vuex当musicListId，只是作为一个唯一标识）\n      recommendMusicListId: 'recommendMusic'\n    }\n  },\n  methods: {\n    //   请求\n    // 获取每日推荐歌曲\n    async getRecommendMusic () {\n      const res = await this.$request('/recommend/songs', {\n        changeOrigin: true\n      })\n      this.recommendMusic = res.data.data.dailySongs\n      // 处理时间\n      this.recommendMusic.forEach((item, index) => {\n        this.recommendMusic[index].dt = handleMusicTime(item.dt)\n      })\n    },\n\n    // 事件\n    // 点击播放全部按钮的回调\n    playAll () {\n      console.log(this.recommendMusic)\n      this.$store.commit('updateMusicId', this.recommendMusic[0].id)\n      this.$store.commit('updateMusicList', {\n        musicList: this.recommendMusic,\n        musicListId: this.recommendMusicListId\n      })\n    },\n    // 处理table索引\n    handleIndex (index) {\n      // console.log(index);\n      index += 1\n      if (index < 10) {\n        return '0' + index\n      } else {\n        return index\n      }\n    },\n    // 双击table的row的回调\n    // 播放音乐的逻辑操作\n    async clickRow (row) {\n      // console.log(row.id)\n      // 将musicId提交到vuex中 供bottomControl查询歌曲url和其它操作\n      this.$store.commit('updateMusicId', row.id)\n      // 如果歌单发生变化,则提交歌单到vuex\n      if (this.recommendMusicListId !== this.$store.state.musicListId) {\n        // 将歌单传到vuex\n        this.$store.commit('updateMusicList', {\n          musicList: this.recommendMusic,\n          musicListId: this.recommendMusicListId\n        })\n      }\n    },\n\n    // 操作 DOM\n    handleDOM (current, last) {\n      if (document.querySelector('.recommendMusic')) {\n        const tableRows = document\n          .querySelector('.recommendMusic')\n          .querySelectorAll('.el-table__row')\n        // 遍历当前musicList 找到当前播放的index的行进行渲染\n        // console.log(tableRows);\n        const index = this.recommendMusic.findIndex((item) => item.id === current)\n        // console.log(index);\n        if (index !== -1) {\n          // 直接修改dom样式的颜色无效\n          // 通过引入全局样式解决\n          // 将正在播放的音乐前面的索引换成小喇叭\n          tableRows[index].children[0].querySelector(\n            '.cell'\n          ).innerHTML = '<div><i class=\"iconfont icon-yinliang\"></i></div>'\n          tableRows[index].children[0]\n            .querySelector('.iconfont')\n            .classList.add('currentRow')\n          tableRows[index].children[2]\n            .querySelector('.cell')\n            .classList.add('currentRow')\n        }\n        // 清除上一首的样式\n        if (last !== -1) {\n          const lastIndex = this.recommendMusic.findIndex(\n            (item) => item.id === last\n          )\n          if (lastIndex !== -1) {\n            // 将上一个播放的dom的小喇叭换回索引\n            tableRows[lastIndex].children[0].querySelector(\n              '.cell'\n            ).innerHTML = `<div>${\n              lastIndex + 1 < 10 ? '0' + (lastIndex + 1) : lastIndex + 1\n            }</div>`\n\n            // 将上一首的类名删掉  小喇叭的html已经被替换了，不需要再还原\n            tableRows[lastIndex].children[2]\n              .querySelector('.cell')\n              .classList.remove('currentRow')\n          }\n        }\n      }\n    },\n\n    async clickCell (row, column, cell) {\n      // 判断点击的是下载按钮\n      if (cell.querySelector('.icon-download')) {\n        // 请求该歌曲的url\n        console.log(row)\n        const res = await this.$request('/song/url', { id: row.id })\n        console.log(res.data.data[0].url)\n        console.log(res)\n        if (res.data.data[0].url == null) {\n          this.$message.warning('暂时无法获取该资源哦!')\n          return\n        }\n\n        // 匹配资源的域名\n        const url = res.data.data[0].url.match(/http.*?\\.net/)\n        // 匹配域名名称，并匹配对应的代理\n        const serve = url[0].match(/http:\\/(\\S*).music/)[1]\n        if (\n          serve !== '/m7' &&\n          serve !== '/m701' &&\n          serve !== '/m8' &&\n          serve !== '/m801'\n        ) {\n          // 没有对应的代理\n          this.$message.error('匹配不到对应的代理,下载失败!')\n          return\n        }\n        // 截取后面的参数\n        const params = res.data.data[0].url.slice(url[0].length)\n        // console.log(url[0], serve, params);\n\n        const downloadMusicInfo = {\n          url: serve + params,\n          name:\n            row.name +\n            ' - ' +\n            row.ar[0].name +\n            '.' +\n            res.data.data[0].type.toLowerCase()\n        }\n        console.log(downloadMusicInfo)\n        this.$store.commit('updateDownloadMusicInfo', downloadMusicInfo)\n      }\n    }\n  },\n  created () {\n    if (!this.$store.state.isLogin) {\n      this.$message.error('只有登录后才能进入每日推荐页面哦!')\n      this.$router.replace('/discover')\n    }\n  },\n  async mounted () {\n    if (this.$store.state.isLogin) {\n      await this.getRecommendMusic()\n      // 判断是否和上一次打开的歌单相同\n      if (this.recommendMusicListId === this.$store.state.musicListId) {\n        this.handleDOM(this.$store.state.musicId)\n      }\n    }\n  },\n  watch: {\n    '$store.state.musicId' (current, last) {\n      this.handleDOM(current, last)\n    }\n  }\n}\n</script>\n\n<style scoped>\n.recommendInfo {\n  padding: 20px;\n}\n\n.title {\n  display: flex;\n}\n\n.cover {\n  width: 90px;\n}\n\n.cover img {\n  width: 100%;\n}\n\n.titleInfo {\n  padding: 15px 10px;\n}\n\n.infoTop {\n  font-size: 19px;\n  font-weight: bold;\n  color: black;\n  margin: 3px 0;\n}\n\n.infoBottom {\n  font-size: 12px;\n}\n\n.buttons {\n  margin: 8px 0 0 3px;\n  display: flex;\n}\n\n.buttonItem {\n  font-size: 12px;\n  padding: 8px 15px;\n  border: 1px solid #ddd;\n  border-radius: 20px;\n  transform: scale(0.9);\n}\n\n.buttonItem i {\n  font-size: 12px;\n  margin-right: 3px;\n  transform: scale(0.9);\n}\n\n.playAll {\n  background-color: #ec4141;\n  color: white;\n}\n\n.placeholder {\n  width: 100%;\n  height: 50px;\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RecommendMusic.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RecommendMusic.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./RecommendMusic.vue?vue&type=template&id=646eb792&scoped=true&\"\nimport script from \"./RecommendMusic.vue?vue&type=script&lang=js&\"\nexport * from \"./RecommendMusic.vue?vue&type=script&lang=js&\"\nimport style0 from \"./RecommendMusic.vue?vue&type=style&index=0&id=646eb792&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"646eb792\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RecommendMusic.vue?vue&type=style&index=0&id=646eb792&scoped=true&lang=css&\"","module.exports = __webpack_public_path__ + \"img/recommendMusic.dadb06d2.png\";"],"sourceRoot":""}