(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e06e0aa2"],{"1ba7":function(t,e,s){},2909:function(t,e,s){"use strict";function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,i=new Array(e);s<e;s++)i[s]=t[s];return i}function a(t){if(Array.isArray(t))return i(t)}s.d(e,"a",(function(){return o}));s("a4d3"),s("e01a"),s("d3b7"),s("d28b"),s("3ca3"),s("ddb0"),s("a630");function n(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}s("fb6a"),s("b0c0"),s("ac1f"),s("00b4");function r(t,e){if(t){if("string"===typeof t)return i(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?i(t,e):void 0}}s("d9e2");function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(t){return a(t)||n(t)||r(t)||c()}},"3bc6":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.load,expression:"load"}],staticClass:"UserListCard",attrs:{"infinite-scroll-disabled":t.disabled,"infinite-scroll-distance":300,"infinite-scroll-immediate":!1}},t._l(t.userList,(function(e,i){return s("div",{key:i,staticClass:"userItemContainer",on:{click:function(s){return t.clickUser(e.userId)}}},[s("div",{staticClass:"userItem"},[s("div",{staticClass:"left"},[s("img",{staticClass:"avatar",attrs:{src:e.avatarUrl+"?param=200y200",alt:""}})]),s("div",{staticClass:"right"},[s("div",{staticClass:"nickName"},[t._v(t._s(e.nickname))]),s("div",{staticClass:"signature"},[t._v(" "+t._s(e.signature)+" ")]),"personalPage"==t.userType?s("div",{staticClass:"nums"},[s("div",{staticClass:"musicListNum"},[t._v(t._s("歌单: "+e.playlistCount))]),s("div",{staticClass:"fenge"},[t._v("|")]),s("div",{staticClass:"followedsNum"},[t._v(t._s("粉丝: "+e.followeds))])]):t._e()])])])})),0)},a=[],n={name:"UserListCard",props:{userList:{type:Array,default:function(){return[]}},isLoad:{type:Boolean,default:function(){return!1}},userType:{type:String,default:function(){return"personalPage"}}},data:function(){return{disabled:!0}},methods:{clickUser:function(t){this.$router.push({name:"personal",params:{uid:t}})},load:function(){this.$emit("bottomLoad"),this.disabled=!0}},watch:{userList:function(){!0===this.isLoad&&(0!==this.userList.length?this.disabled=!1:this.disabled=!0)}}},r=n,c=(s("b7b6"),s("2877")),o=Object(c["a"])(r,i,a,!1,null,"59091b2d",null);e["a"]=o.exports},a630:function(t,e,s){var i=s("23e7"),a=s("4df4"),n=s("1c7e"),r=!n((function(t){Array.from(t)}));i({target:"Array",stat:!0,forced:r},{from:a})},b258:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.musicListDetail?s("div",{staticClass:"musicListDetail"},[s("div",{staticClass:"listInfo"},[s("div",{staticClass:"listAvatar"},[s("img",{attrs:{src:t.musicListDetail.coverImgUrl,alt:""}})]),s("div",{staticClass:"right"},[s("div",{staticClass:"title"},[s("div",{staticClass:"titleTag"},[t._v("歌单")]),s("div",{staticClass:"titleContent"},[t._v(t._s(t.musicListDetail.name))])]),s("div",{staticClass:"user"},[s("div",{staticClass:"userAvatar"},[s("img",{attrs:{src:t.musicListDetail.creator.avatarUrl,alt:""}})]),s("div",{staticClass:"userName",on:{click:function(e){return t.$router.push({name:"personal",params:{uid:t.musicListDetail.creator.userId}})}}},[t._v(" "+t._s(t.musicListDetail.creator.nickname)+" ")]),s("div",{staticClass:"createTime"},[t._v(" "+t._s(t._f("showDate")(t.musicListDetail.createTime))+"创建 ")])]),s("div",{staticClass:"buttons"},[s("div",{staticClass:"buttonItem playAll",on:{click:t.playAll}},[s("i",{staticClass:"iconfont icon-bofang playAll"}),s("span",[t._v("播放全部")])]),t.isCreated?t._e():s("div",{staticClass:"buttonItem",on:{click:t.collectList}},[s("i",{staticClass:"iconfont icon-xihuan",class:t.isSub?"red":""}),s("span",[t._v(t._s(t.isSub?"已收藏":"收藏"))])]),t._m(0)]),s("div",{staticClass:"tags"},[t._v(" 标签： "),t._l(t.musicListDetail.tags,(function(e,i){return s("div",{key:i,staticClass:"tagItem",on:{click:function(s){return t.toDiscoverMusicList(e)}}},[t._v(" "+t._s(e)+" ")])})),0==t.musicListDetail.tags.length?s("div",[t._v("暂无标签")]):t._e()],2),s("div",{staticClass:"otherInfo"},[s("div",{staticClass:"musicNum"},[t._v(" 歌曲 : "+t._s(t._f("handleNum")(t.musicListDetail.trackCount))+" ")]),s("div",{staticClass:"playCount"},[t._v(" 播放 : "+t._s(t._f("handleNum")(t.musicListDetail.playCount))+" ")])]),s("div",{staticClass:"desc"},[t._v(" 简介 : "+t._s(t.musicListDetail.description?t.musicListDetail.description:"暂无简介")+" ")])])]),s("div",{staticClass:"musicList"},[s("el-tabs",{attrs:{value:"first"},on:{"tab-click":t.clickTab}},[s("el-tab-pane",{attrs:{label:"歌曲列表",name:"first"}},[s("el-table",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:this.$store.state.isLogin?t.loadMore:"",expression:"this.$store.state.isLogin ? loadMore : ''"}],staticStyle:{width:"100%"},attrs:{data:t.musicListDetail.tracks,size:"mini","highlight-current-row":"",stripe:"",lazy:"","row-key":function(t){return t.id},"infinite-scroll-disabled":t.scrollLoadDisabled,"infinite-scroll-distance":1500,"infinite-scroll-immediate":!1},on:{"row-dblclick":t.clickRow,"cell-click":t.clickCell}},[s("el-table-column",{attrs:{label:"",width:"40",type:"index",index:t.handleIndex}}),s("el-table-column",{attrs:{label:"",width:"23"}},[s("i",{staticClass:"iconfont icon-download"})]),s("el-table-column",{attrs:{prop:"name",label:"音乐标题","min-width":"350"}}),s("el-table-column",{attrs:{prop:"ar[0].name",label:"歌手","min-width":"120"}}),s("el-table-column",{attrs:{prop:"al.name",label:"专辑","min-width":"170"}}),s("el-table-column",{attrs:{prop:"dt",label:"时长","min-width":"100"}})],1),t.isMore&&!this.$store.state.isLogin?s("div",{staticClass:"loadMore"},[t._v(" 登陆后查看更多音乐 ")]):s("div",{staticClass:"placeholder"})],1),s("el-tab-pane",{attrs:{label:"评论",name:"second"}},[t.comments.comments?s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isCommentLoading,expression:"isCommentLoading"}],staticClass:"commentList"},[t.comments.hotComments?s("comment",{ref:"hotComments",attrs:{commentType:"musicList",comments:t.comments.hotComments,commentId:t.musicListDetail.id+""},on:{getComment:t.getMusicListComment,scrollToComment:t.scrollToComment}},[s("div",{attrs:{slot:"title"},slot:"title"},[t._v("精彩评论")])]):t._e(),s("comment",{attrs:{comments:t.comments.comments,commentType:"musicList",commentId:t.musicListDetail.id+"",isHotComment:!t.comments.hotComments},on:{getComment:t.getMusicListComment,scrollToComment:t.scrollToComment,transToHotComment:function(e){return t.$refs.hotComments.floorComment(e.commentId,e.nickName)}}},[s("div",{attrs:{slot:"title"},slot:"title"},[t._v("热门评论")])])],1):t._e(),s("div",{directives:[{name:"show",rawName:"v-show",value:t.comments.comments&&0!=t.comments.comments.length,expression:"comments.comments && comments.comments.length != 0"}],staticClass:"page"},[s("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.comments.total,small:"","page-size":50,"current-page":t.currentCommentPage},on:{"current-change":t.commentPageChange}})],1)]),s("el-tab-pane",{attrs:{label:"收藏者",name:"third"}},[s("user-list-card",{attrs:{userType:"musicListDetailPage",userList:t.followedsListData.followedsList,isLoad:t.followedsListData.isMore},on:{bottomLoad:t.bottomLoad}}),0==t.followedsListData.followedsList.length&&0==t.followedsListData.isLoaded?s("div",{staticClass:"tips"},[t._v(" 暂无收藏者 ")]):t._e()],1)],1)],1),s("go-top",{attrs:{scrollObj:".musicListDetail"}})],1):t._e()},a=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"buttonItem"},[s("i",{staticClass:"iconfont icon-zhuanfa"}),s("span",[t._v("分享")])])}],n=s("2909"),r=s("c7eb"),c=s("1da1"),o=(s("d3b7"),s("159b"),s("c740"),s("fb6a"),s("7db0"),s("25f0"),s("ac1f"),s("466d"),s("b0c0"),s("aa2a")),l=s("67f1"),u=s("7cff"),m=s("3bc6"),d={name:"musicListDetail",data:function(){return{musicListDetail:null,comments:{},currentCommentPage:1,isMore:!1,isSub:!1,isCreated:!1,isCommentLoading:!1,scrollLoadDisabled:!1,followedsListData:{currentPage:1,followedsList:[],isMore:!1,isLoaded:!1}}},components:{Comment:l["a"],GoTop:u["a"],UserListCard:m["a"]},methods:{getMusicListDetail:function(){var t=this;return Object(c["a"])(Object(r["a"])().mark((function e(){var s,i;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=Date.parse(new Date),e.next=3,t.$request("/playlist/detail",{id:t.$route.params.id,timestamp:s});case 3:i=e.sent,t.musicListDetail=i.data.playlist,t.musicListDetail.tracks.length!==t.musicListDetail.trackIds.length&&(t.isMore=!0),t.musicListDetail.tracks.forEach((function(e,s){t.musicListDetail.tracks[s].dt=Object(o["b"])(e.dt)}));case 7:case"end":return e.stop()}}),e)})))()},getMusicListComment:function(t){var e=this;return Object(c["a"])(Object(r["a"])().mark((function s(){var i,a;return Object(r["a"])().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return i=Date.parse(new Date),e.isCommentLoading=!0,"changePage"===t&&e.scrollToComment(),s.next=5,e.$request("/comment/playlist",{id:e.$route.params.id,offset:50*(e.currentCommentPage-1),limit:50,timestamp:i});case 5:a=s.sent,200!==a.data.code&&e.$message.error("获取评论失败,请稍后重试!"),e.comments=a.data,e.isCommentLoading=!1;case 9:case"end":return s.stop()}}),s)})))()},scrollToComment:function(){var t=document.querySelector(".musicListDetail"),e=document.querySelector(".listInfo");t.scrollTo({behavior:"smooth",top:e.clientHeight-20})},getMusicDetail:function(t){var e=this;return Object(c["a"])(Object(r["a"])().mark((function s(){var i,a;return Object(r["a"])().wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(!1!==e.isMore){s.next=2;break}return s.abrupt("return");case 2:return e.scrollLoadDisabled=!0,s.next=5,e.$request("/song/detail",{ids:t});case 5:a=s.sent,a.data.songs.forEach((function(t,e){a.data.songs[e].dt=Object(o["b"])(t.dt)})),(i=e.musicListDetail.tracks).push.apply(i,Object(n["a"])(a.data.songs)),e.musicListDetail.tracks.length<e.musicListDetail.trackIds.length?(e.isMore=!0,e.scrollLoadDisabled=!1):e.isMore=!1;case 9:case"end":return s.stop()}}),s)})))()},toDiscoverMusicList:function(t){this.$router.push({path:"/discover/musiclist/musiclistindex",params:{cat:t}})},getUserMusicList:function(){var t=this;return Object(c["a"])(Object(r["a"])().mark((function e(){var s,i,a;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=Date.parse(new Date),e.next=3,t.$request("/user/playlist",{uid:window.localStorage.getItem("userId"),timestamp:s});case 3:i=e.sent,i=i.data.playlist,a=i.findIndex((function(t){return!0===t.subscribed})),t.collectedMusicList=i.slice(a),t.$store.commit("updateCollectMusicList",t.collectedMusicList);case 8:case"end":return e.stop()}}),e)})))()},getMusicListFolloweds:function(){var t=this;return Object(c["a"])(Object(r["a"])().mark((function e(){var s,i;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$request("/playlist/subscribers",{id:t.$route.params.id,offset:20*(t.followedsListData.currentPage-1)});case 2:i=e.sent,t.followedsListData.isMore=i.data.more,(s=t.followedsListData.followedsList).push.apply(s,Object(n["a"])(i.data.subscribers));case 5:case"end":return e.stop()}}),e)})))()},handleIndex:function(t){return t+=1,t<10?"0"+t:t},clickRow:function(t){var e=this;return Object(c["a"])(Object(r["a"])().mark((function s(){return Object(r["a"])().wrap((function(s){while(1)switch(s.prev=s.next){case 0:e.$store.commit("updateMusicId",t.id),e.musicListDetail.id!==e.$store.state.musicListId&&e.$store.commit("updateMusicList",{musicList:e.musicListDetail.tracks,musicListId:e.musicListDetail.id});case 2:case"end":return s.stop()}}),s)})))()},playAll:function(){this.$store.commit("updateMusicId",this.musicListDetail.tracks[0].id),this.$store.commit("updateMusicList",{musicList:this.musicListDetail.tracks,musicListId:this.musicListDetail.id})},commentPageChange:function(t){this.currentCommentPage=t,this.getMusicListComment("changePage")},handleDOM:function(t,e){if(document.querySelector(".musicListDetail")){var s=document.querySelector(".musicListDetail").querySelectorAll(".el-table__row"),i=this.musicListDetail.tracks.findIndex((function(e){return e.id===t}));if(-1!==i&&(s[i].children[0].querySelector(".cell").innerHTML='<div><i class="iconfont icon-yinliang"></i></div>',s[i].children[0].querySelector(".iconfont").classList.add("currentRow"),s[i].children[2].querySelector(".cell").classList.add("currentRow")),-1!==e){var a=this.musicListDetail.tracks.findIndex((function(t){return t.id===e}));-1!==a&&(s[a].children[0].querySelector(".cell").innerHTML="<div>".concat(a+1<10?"0"+(a+1):a+1,"</div>"),s[a].children[2].querySelector(".cell").classList.remove("currentRow"))}}},clickTab:function(t){"1"!==t.index||this.comments.comments?"2"!==t.index||this.followedsListData.isLoaded||(this.getMusicListFolloweds(),this.followedsListData.isLoaded=!0):this.getMusicListComment()},loadMore:function(){if(this.$store.state.isLogin){var t=this.musicListDetail.trackIds.slice(this.musicListDetail.tracks.length);t.length>100&&(t=t.slice(0,100));var e="";t.forEach((function(t){e+=t.id+","})),e=e.substr(0,e.length-1),this.getMusicDetail(e)}else this.$message.error("请先进行登录操作!")},getIsSub:function(){var t=this;this.isSub=this.$store.state.collectMusicList.find((function(e){return e.id.toString()===t.$route.params.id.toString()}))},getIsCreated:function(){var t=this;this.isCreated=this.$store.state.createdMusicList.find((function(e){return e.id.toString()===t.$route.params.id.toString()}))},collectList:function(){var t=this;return Object(c["a"])(Object(r["a"])().mark((function e(){var s;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.$store.state.isLogin){e.next=3;break}return t.$message.error("请先进行登录操作!"),e.abrupt("return");case 3:return t.isSub=!t.isSub,s=Date.parse(new Date),e.next=7,t.$request("/playlist/subscribe",{id:t.$route.params.id,t:t.isSub?1:2,timestamp:s});case 7:t.getUserMusicList();case 8:case"end":return e.stop()}}),e)})))()},clickCell:function(t,e,s){var i=this;return Object(c["a"])(Object(r["a"])().mark((function e(){var a,n,c,o,l;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!s.querySelector(".icon-download")){e.next=15;break}return e.next=3,i.$request("/song/url",{id:t.id});case 3:if(a=e.sent,null!=a.data.data[0].url){e.next=7;break}return i.$message.warning("暂时无法获取该资源哦!"),e.abrupt("return");case 7:if(n=a.data.data[0].url.match(/http.*?\.net/),c=n[0].match(/http:\/(\S*).music/)[1],"/m7"===c||"/m701"===c||"/m8"===c||"/m801"===c){e.next=12;break}return i.$message.error("匹配不到对应的代理,下载失败!"),e.abrupt("return");case 12:o=a.data.data[0].url.slice(n[0].length),l={url:c+o,name:t.name+" - "+t.ar[0].name+"."+a.data.data[0].type.toLowerCase()},i.$store.commit("updateDownloadMusicInfo",l);case 15:case"end":return e.stop()}}),e)})))()},bottomLoad:function(){this.followedsListData.currentPage+=1,this.getMusicListFolloweds()}},computed:{},watch:{"$store.state.createdMusicList":function(t,e){0===e.length&&this.getIsSub()},"$store.state.collectMusicList":function(t,e){this.getIsSub()}},filters:{showDate:function(t){var e=new Date(t);return Object(o["a"])(e,"yyyy-MM-dd")},handleNum:o["c"]},created:function(){},mounted:function(){var t=this;return Object(c["a"])(Object(r["a"])().mark((function e(){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$store.state.isLogin&&(t.getIsCreated(),t.isCreated||t.getIsSub()),e.next=3,t.getMusicListDetail();case 3:t.$nextTick((function(){t.$route.params.id===t.$store.state.musicListId&&t.handleDOM(t.$store.state.musicId)}));case 4:case"end":return e.stop()}}),e)})))()}},f=d,h=(s("f39e"),s("2877")),b=Object(h["a"])(f,i,a,!1,null,"491e06dc",null);e["default"]=b.exports},b7b6:function(t,e,s){"use strict";s("d95b")},d95b:function(t,e,s){},f39e:function(t,e,s){"use strict";s("1ba7")}}]);
//# sourceMappingURL=chunk-e06e0aa2.c91e176f.js.map